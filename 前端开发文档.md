### 撤销
目前暂定撤销只撤销笔迹，不对文字与图片等撤销。
~~将所有自己的笔迹都保存在一个栈中，撤销即pop()操作，pop()之后进行重新绘制~~

对绘制栈从上往下遍历，删除第一个自己留下的笔迹，并发送

撤销 + 笔迹hash的信息

触发重新绘制

这里需要统一所有的绘制信息
根据type分别进行绘制
统一为
{
    type: 'brush' | 'text' | 'image' | 'graph',
    data: any
}
在判断是否撤销是仅撤销bursh痕迹
其余痕迹也可考虑进行撤销，加入history字段，可以保存上次的hash值
但是这样在首次加载时需要加载很多数据，也可只加载上一个history，在撤销到上次时，再获取上次的上次
进行分段的获取。
前端的实现中对brush的数据格式以及draw方法都需要重写
将所有的绘制都集成为一个draw方法

### 重新绘制
~~绘制历史笔迹+新加入的图片+新加入的文字+新加入的笔迹~~

遍历绘制栈进行绘制

### 笔刷状态

用户笔刷状态，默认进入时是选择笔的状态
stauts= {
    1, // 选择笔的状态
    2, // 选择插入文字的状态
    3, // 选择插入图片的状态
}
在非选中笔的状态时，可以选中已经插入的文字和图片，进行位置等调整


### 插入文字功能
插入文字使用fillText(text,x,y) , 在使用前通过ctx.font(大小,字体)设置字体和大小
通过testMsg = ctx.measureText(text)获取相关信息
文字宽度 textMsg.width
文字高度 textMsg.actualBoundingBoxAscent + testMsg.actualBoundingBoxDescent
实现的方式目前考虑的是在选择插入文字之后在点击的位置插入一个透明的input的框，input失去焦点之后将input的value值返回并插入到text中
点击文字之后在他周围生成边框
拖拽之后删除原先数据并将新数据插入
决定拖拽功能以后再实现

### 插入图片功能
插入图片通过drawImage(image, x, y, height, width) 实现
iamge通过new Image();
设定iamge.src = 图片地址
预计在插入图片时，首先上传图片给后端，又后端生成图片地址，返回前端后，放在src中
需注意前端加载图片需要一小会，在onload中进行后续操作
image.onload = () => {
    ctx.drawImage(image, pointerInfo.x, pointerInfo.y, 150, 150);
}

### 笔迹数据
{
    userId,
    userName,
    boardId,
    type: 'handwriting' | 'test' | 'image' | 'delect'
    data: {
        ....
    },
    hash: 笔迹hash值区分某次
}

data分情况
type = 'handwriting'
data = [{
    beginX,
    beginY,
    lastX,
    lastY,
    strokeStyle,
    lineWidth
}]
ps: data由很多这样的数据类型组成的一个数组

type = 'test'
data = {
    test,
    fontWidth,
    fontFamily,
    x,
    y,
}
ps：后续加上拖拽功能需要加上witdh和height这类字段用于定位

type = 'image'
data = {
  x: any,
  y: any,
  src: any,
  width: any,
  height: any
}


type = 'delect'

ps delect情况下不需要data，只需要对应的hash即可



### 历史版本信息
historyList
{
    userId,
    userName,
    date,
    boardId,
    hash, 
}

这里的hash值可以与笔迹一致，标识某次操作之后的白板，有后端进行组装之后发送

### 登录功能
在进入白板时，可以选择登录或者不登陆
不做页面跳转，在一个dialog框中完成登录，输入白板id等功能
dialog起始选项为
登录按钮
白板id输入框
进入按钮

点击登录按钮，则切换为登录模式
用户账号
用户密码
忘记密码等

登录之后上述的登录按钮转换为用户头像
暂时不做注册功能

### 参照
https://github.com/wanglin2/tiny_whiteboard
https://excalidraw.com/

### 样式重写
登录时的按钮
笔刷按钮

### 任务安排
~~登录按钮样式~~
~~笔刷按钮样式~~
选中功能
插入文字调整
插入图片功能调整
插入图片更改为插入base64值
图片转换为base64值功能
插入文字可选字体，大小等
插入矩形功能
插入圆形功能